
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://altmannpeter.github.io/SEUDIW/onboarding/">
      
      
        <link rel="prev" href="../R2PS-service-types/">
      
      
        <link rel="next" href="../revocation-noaccess/">
      
      
        
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Onboarding - Swedish EUDIW Technical Specifications</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#wallet-onboarding-flow" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="Swedish EUDIW Technical Specifications" class="md-header__button md-logo" aria-label="Swedish EUDIW Technical Specifications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Swedish EUDIW Technical Specifications
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Onboarding
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="green" data-md-color-accent="deep-purple"  aria-label="Dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="deep-orange"  aria-label="Light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/diggsweden/wallet-technical-specifications" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="Swedish EUDIW Technical Specifications" class="md-nav__button md-logo" aria-label="Swedish EUDIW Technical Specifications" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    Swedish EUDIW Technical Specifications
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/diggsweden/wallet-technical-specifications" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M439.6 236.1 244 40.5c-5.4-5.5-12.8-8.5-20.4-8.5s-15 3-20.4 8.4L162.5 81l51.5 51.5c27.1-9.1 52.7 16.8 43.4 43.7l49.7 49.7c34.2-11.8 61.2 31 35.5 56.7-26.5 26.5-70.2-2.9-56-37.3L240.3 199v121.9c25.3 12.5 22.3 41.8 9.1 55-6.4 6.4-15.2 10.1-24.3 10.1s-17.8-3.6-24.3-10.1c-17.6-17.6-11.1-46.9 11.2-56v-123c-20.8-8.5-24.6-30.7-18.6-45L142.6 101 8.5 235.1C3 240.6 0 247.9 0 255.5s3 15 8.5 20.4l195.6 195.7c5.4 5.4 12.7 8.4 20.4 8.4s15-3 20.4-8.4l194.7-194.7c5.4-5.4 8.4-12.8 8.4-20.4s-3-15-8.4-20.4"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Index
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Access Mechanism
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Access Mechanism
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../loa-high-access-mechanism/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Assessment
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Remote PAKE-Protected Services
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            
  
    Remote PAKE-Protected Services
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../R2PS-protocol/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Protocol
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../R2PS-service-types/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Services
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    
  
    Onboarding
  

    
  </span>
  
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            
  
    Onboarding
  

          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    
  
    Onboarding
  

    
  </span>
  
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    
  
    Onboarding
  

    
  </span>
  
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-statement-and-desired-outcome" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement and Desired Outcome
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-decision-drivers-and-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Decision, Drivers, and Requirements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope-and-related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scope and Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onboarding-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Onboarding Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Onboarding Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sequence Diagram
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-1-4-wallet-app-install-and-initiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 1-4: Wallet App Install and Initiation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-5-11-account-creation-and-device-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 5-11: Account Creation and Device Registration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-12-26-second-factor-check-and-wua-issuance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 12-26: Second Factor Check and WUA Issuance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-27-39-delegated-revocation-authority-with-oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 27-39: Delegated Revocation Authority with OAuth 2.0
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../revocation-noaccess/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Revocation
  

    
  </span>
  
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#problem-statement-and-desired-outcome" class="md-nav__link">
    <span class="md-ellipsis">
      
        Problem Statement and Desired Outcome
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#success-criteria" class="md-nav__link">
    <span class="md-ellipsis">
      
        Success Criteria
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#design-decision-drivers-and-requirements" class="md-nav__link">
    <span class="md-ellipsis">
      
        Design Decision, Drivers, and Requirements
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#scope-and-related-documentation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Scope and Related Documentation
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#onboarding-flow" class="md-nav__link">
    <span class="md-ellipsis">
      
        Onboarding Flow
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Onboarding Flow">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#overview" class="md-nav__link">
    <span class="md-ellipsis">
      
        Overview
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#sequence-diagram" class="md-nav__link">
    <span class="md-ellipsis">
      
        Sequence Diagram
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-1-4-wallet-app-install-and-initiation" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 1-4: Wallet App Install and Initiation
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-5-11-account-creation-and-device-registration" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 5-11: Account Creation and Device Registration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-12-26-second-factor-check-and-wua-issuance" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 12-26: Second Factor Check and WUA Issuance
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#steps-27-39-delegated-revocation-authority-with-oauth-20" class="md-nav__link">
    <span class="md-ellipsis">
      
        Steps 27-39: Delegated Revocation Authority with OAuth 2.0
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  


  
  


<h1 id="wallet-onboarding-flow">Wallet Onboarding Flow</h1>
<p><strong>Status</strong>: Draft</p>
<p><strong>Executive summary</strong>: This document describes the onboarding flow for the digital identity wallet, which uses two-factor authentication: a hardware-backed device key (possession) and a PIN (knowledge). The Wallet Provider verifies both and links them to an HSM key. User identification and PID issuance are handled separately by the PID Provider. The flow supports critical functions (e.g., revocation) even if all devices are lost.</p>
<h2 id="problem-statement-and-desired-outcome">Problem Statement and Desired Outcome</h2>
<p>A digital identity wallet must establish two-factor authentication to support high-assurance operations. The possession factor is a hardware-protected device key, with attestation confirming it is stored in tamper-resistant hardware. The knowledge factor is a user-chosen PIN, registered via an augmented PAKE protocol (OPAQUE).</p>
<p>The Wallet Provider requires a user account to enable certain wallet functionality. Crucially, the Wallet Provider verifies both authentication factors, and then generates a distinct HSM-protected signing key for that wallet device.</p>
<p>The result is a registered wallet instance with an HSM-protected signing key associated with both authentication factors and a Wallet Unit Attestation (WUA) that can be presented to attestation issuers. A user account may be linked to multiple wallet devices (account creating and management are out of scope).</p>
<p>The onboarding flow supports a range of privacy-preserving wallet features, including <a href="https://github.com/diggsweden/wallet-expert-group/blob/main/docs/revocation/revocation.md">revocation if all of a user's registered devices are lost</a>.</p>
<h2 id="success-criteria">Success Criteria</h2>
<p>Onboarding is successful when the following criteria are met:</p>
<ol>
<li>The possession factor is registered with the Wallet Provider.</li>
<li>The knowledge factor is registered with the Wallet Provider.</li>
<li>An HSM-protected signing key is generated and stored in the user's wallet account.</li>
<li>An WUA containing the HSM-protected signing key is issued to the device.</li>
<li>The device is ready to obtain a PID.</li>
<li>Revocation mechanisms are established that do not depend on user access to the wallet account.</li>
</ol>
<blockquote>
<p>Note 1: The WUA provides cryptographic proof to the PID Provider that the PoP key (i.e., the HSM-protected key) is protected by two-factor authentication verified by the Wallet Provider, establishing the Level of Assurance required for PID issuance.</p>
<p>Note 2: The Wallet Provider verifies both authentication factors and attests to their validity. The PID Provider identifies the user and associates this identification with the HSM-protected PoP key.</p>
<p>Note 3: The revocation mechanism established during onboarding complements other mechanisms available when the user retains access to their wallet account (not detailed herein).</p>
</blockquote>
<h2 id="design-decision-drivers-and-requirements">Design Decision, Drivers, and Requirements</h2>
<p>The following decision drivers apply:</p>
<ul>
<li>The Wallet Provider MUST NOT learn the user’s real-world identity during onboarding or wallet operations, even if this necessitates additional steps or responsibilities.</li>
<li>For LoA High, the wallet MUST establish two independent authentication factors: possession (hardware-protected device key) and knowledge (PIN).</li>
<li>Device keys MUST be hardware-backed with verifiable proof of tamper-resistant storage.</li>
<li>To limit breach impact and protect privacy, registration MUST prevent the Wallet Provider from learning the PIN and attackers from accessing any usable user data.</li>
<li>PIN registration MUST occur over a secure session initiated with the device key to bind possession and knowledge factors.</li>
<li>Users MUST NOT be required to remember or store any information beyond their PIN for onboarding or subsequent wallet operations.</li>
<li>The solution MUST support multiple devices per user, with each device having independent possession and knowledge factors and distinct HSM-protected signing keys.</li>
</ul>
<blockquote>
<p>Note: Previously, we considered supporting multiple devices per wallet instance. However, this requires a cloud-based wallet and adds complexity. A simpler, architecture-agnostic approach is to allow only one device per wallet instance. The PID Provider may impose additional limits on how many instances receive a PID.</p>
</blockquote>
<h2 id="scope-and-related-documentation">Scope and Related Documentation</h2>
<p>This document describes the <strong>initial wallet onboarding flow</strong> for a user's first device. The following scenarios are excluded from this document and will be covered separately:</p>
<ul>
<li>
<p><strong>Adding Additional Devices</strong>: Authorizing a new device when a user already has a registered wallet.</p>
</li>
<li>
<p><strong>Revocation Scenarios</strong>: Methods for revoking wallet instances when all devices are lost, stolen, or compromised, and the user cannot access their wallet account.</p>
</li>
<li>
<p><strong>Wallet Recovery</strong>: Mechanisms for recovering wallet access after device loss.</p>
</li>
<li>
<p><strong>Attestation (Re-)Issuance</strong>: Obtaining attestations beyond the initial issuance of the WUA.</p>
</li>
</ul>
<h2 id="onboarding-flow">Onboarding Flow</h2>
<p>This section outlines the wallet onboarding process from the device perspective, with a sequence diagram followed by step-by-step descriptions.</p>
<h3 id="overview">Overview</h3>
<p>Onboarding consists of the following steps (happy path):</p>
<ol>
<li>The user installs the Wallet App and opens it for the first time.</li>
<li>Device generates a hardware-protected key pair and obtains a key attestation.</li>
<li>The device registers with the Wallet Provider, which triggers account creation (out of scope).</li>
<li>The Wallet Provider issues a WUA after completing the following:<ul>
<li>Cloud wallet: The device registers a PIN with the Wallet Provider over a secure session initiated using the device key (cf. OPAQUE). The Wallet Provider then generates an HSM-protected signing key and links it to the user account.</li>
<li>Mobile wallet: The Wallet Provider accepts the device key as the hardware-protected signing key, based on a key attestation confirming the required security level and user authentication(cf. <a href="https://source.android.com/docs/security/features/keystore/attestation">StrongBox</a> and <a href="https://developer.apple.com/documentation/security/protecting-keys-with-the-secure-enclave">Secure Enclave</a> for details).</li>
</ul>
</li>
<li>The Wallet Provider issues a WUA containing the hardware-protected signing key. The wallet device is now ready to request a PID.</li>
</ol>
<h3 id="sequence-diagram">Sequence Diagram</h3>
<p>The following sequence diagram illustrates the complete onboarding flow with a focus on a cloud-wallet (happy path). The diagram shows also the required delegation of the revocation authorization.</p>
<pre class="mermaid"><code>sequenceDiagram
    autonumber
    participant User
    participant Wallet as Wallet App/Device
    participant WP as Wallet Provider
    participant HSM
    participant RA as Revocation Agent


    User-&gt;&gt;Wallet: Install and open Wallet App
    Wallet-&gt;&gt;Wallet: Generate hardware-protected key pair
    Wallet-&gt;&gt;Wallet: Generate key attestation
    Wallet-&gt;&gt;Wallet: Generate signed integrity token&lt;br&gt;(Play Integrity API / DeviceCheck and App Attest)

    Wallet-&gt;&gt;Wallet: Create and sign account&lt;br&gt;registration request
    Wallet-&gt;&gt;WP: Account registration request    
    WP-&gt;&gt;WP: Verify integrity token
    WP-&gt;&gt;WP: Verify possession factor using key attestation
    WP-&gt;&gt;WP: Create user account
    WP-&gt;&gt;WP: Register possession factor
    WP-&gt;&gt;Wallet: Account registration response

    alt Native wallet
        WP-&gt;&gt;WP: Verify second factor using key attestation
    else Cloud-HSM
        Wallet-&gt;&gt;User: Prompt for PIN
        User-&gt;&gt;Wallet: Enter PIN
        Wallet-&gt;&gt;Wallet: Apply PIN hardening
        Wallet-&gt;&gt;WP: OPAQUE PIN registration request (using device key)
        WP-&gt;&gt;Wallet: OPAQUE registration response
        Wallet-&gt;&gt;WP: Complete OPAQUE exchange
        WP-&gt;&gt;WP: Register knowledge factor
        WP-&gt;&gt;HSM: Request signing key generation
        HSM-&gt;&gt;HSM: Generate key pair
        HSM-&gt;&gt;WP: Return key envelope
        WP-&gt;&gt;WP: Bind key envelope to user account
    end

    WP-&gt;&gt;WP: Create signed WUA
    WP-&gt;&gt;Wallet: WUA
    Wallet-&gt;&gt;Wallet: Store WUA

    Note over User,HSM: Wallet is now ready for use

    opt Support revocation if all account access is lost
        RA-&gt;&gt;Wallet: Authorization request redirect
        Wallet-&gt;WP: Authentication
        WP-&gt;&gt;Wallet: Request consent
        Wallet-&gt;&gt;User: Present consent prompt
        User-&gt;&gt;Wallet: Accept
        Wallet-&gt;&gt;WP: Reply with consent accept
        WP-&gt;&gt;WP: Create grant record
        WP-&gt;&gt;Wallet: Authorization response redirect with auth code
        Wallet-&gt;&gt;RA: Auth code
        RA-&gt;&gt;WP: Auth code
        WP-&gt;&gt;WP: Validate
        WP-&gt;&gt;RA: Refresh + Access token
        RA-&gt;&gt;RA: Token storage
    end

    Note over User,RA: Wallet is now fully onboarded</code></pre>
<h3 id="steps-1-4-wallet-app-install-and-initiation">Steps 1-4: Wallet App Install and Initiation</h3>
<p>The user downloads and installs the Wallet App on their wallet device, then launches it to begin initialization.</p>
<p><strong>User Action:</strong>
- Complete Wallet App initialization steps (details out of scope).</p>
<p><strong>Device Action:</strong>
- Generates a hardware-protected asymmetric key pair.
- Generates an associated key attestation.
- Generate integrity token (platform specific) </p>
<blockquote>
<p>Note: The specifics of key attestation and the intended use of the device key depend on the certification state of the user's device. A non-certified device requires a cloud wallet, where the device key functions as a context key for authenticated communication with the cloud wallet operator.</p>
</blockquote>
<h3 id="steps-5-11-account-creation-and-device-registration">Steps 5-11: Account Creation and Device Registration</h3>
<p>The device initiates device account registration with the Wallet Provider, submits the required information, and receives a registration completion notification.</p>
<p><strong>Device Action:</strong>
- Device prepares and submits an account registration request to the Wallet Provider containing:
  - Device integrity assurances from Step 4.
  - Device key attestation from Step 3.</p>
<p><strong>Wallet Provider Actions:</strong>
- Verifies integrity token.
- Verifies key attestation.
- Creates user account.
- Registers the possession factor.
- Confirms account registration.</p>
<h3 id="steps-12-26-second-factor-check-and-wua-issuance">Steps 12-26: Second Factor Check and WUA Issuance</h3>
<p>Following device registration, the Wallet Provider has two options. </p>
<p>If key attestation and integrity checks originate from a certified EUDIW device, the Wallet Provider can verify second-factor control using the key attestation alone (Step 12). In this case, in Step 2, the device has already gated access to the signing key behind a second factor.</p>
<p>If not, Steps 13–23 cover prompting the user for a PIN, registering it server-side using OPAQUE, generating the user's HSM-protected signing key, and exporting and associating the key envelope with the user account.</p>
<p>In either case, once the Wallet Provider has confirmed two-factor control and obtained assurance of a hardware-protected key, it creates and signs a WUA, which it then issues to the Wallet App. The user can then request, for example, a PID.</p>
<h3 id="steps-27-39-delegated-revocation-authority-with-oauth-20">Steps 27-39: Delegated Revocation Authority with OAuth 2.0</h3>
<p>To support revocation when a user loses access to their wallet account, a privacy-preserving fallback is required. Normally, users manage devices and recovery via their wallet account, but loss of access necessitates an alternative.</p>
<p>The solution delegates revocation authority to a Revocation Agent during initial onboarding. Once a WUA is issued, the wallet visits a Revocation Agent and initiates with the delegation setup. Later, the user can authenticate to the Revocation Agent, who exchanges their refresh token for an access token. The access token is then submitted to the Wallet Provider's revocation endpoint to complete the revocation.</p>
<p>This approach also covers cases where the Wallet Provider revokes the WUA and must notify the user via a channel other than the wallet device (per TS3 and HLR requirements). The Wallet Provider can reference the delegation token and forward the revocation notice to the designated Revocation Agent.</p>
<p>For details on the delegated revocation, see <a href="https://github.com/diggsweden/wallet-expert-group/blob/main/docs/revocation/revocation.md">revocation.md</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "..", "features": [], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../javascripts/mathjax.js"></script>
      
        <script src="https://unpkg.com/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>